

<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?region=NO&v=3.exp&key=AIzaSyA-AMTBmf7l3Uq-2PEBg2HA7alXJU87beo"></script>
    <script src="rhill-voronoi-core.js"></script>
    <script src="utm.js"></script>
    <script>


        function clip (subjectPolygon, clipPolygon) {

            var cp1, cp2, s, e;
            var inside = function (p) {
                return (cp2[0]-cp1[0])*(p[1]-cp1[1]) > (cp2[1]-cp1[1])*(p[0]-cp1[0]);
            };
            var intersection = function () {
		    //console.log("calcing intersection");
                var dc = [ cp1[0] - cp2[0], cp1[1] - cp2[1] ],
                    dp = [ s[0] - e[0], s[1] - e[1] ],
                    n1 = cp1[0] * cp2[1] - cp1[1] * cp2[0],
                    n2 = s[0] * e[1] - s[1] * e[0],
                    n3 = 1.0 / (dc[0] * dp[1] - dc[1] * dp[0]);
                return [(n1*dp[0] - n2*dc[0]) * n3, (n1*dp[1] - n2*dc[1]) * n3];
            };
            var outputList = subjectPolygon;
            cp1 = clipPolygon[clipPolygon.length-1];
            for (j in clipPolygon) {
		    //console.log("j in clipPolygon");
                var cp2 = clipPolygon[j];
                var inputList = outputList;
                outputList = [];
                s = inputList[inputList.length - 1]; //last on the input list
                for (i in inputList) {
                    var e = inputList[i];
                    if (inside(e)) {
                        if (!inside(s)) {
                            outputList.push(intersection());
                        }
                        outputList.push(e);
                    }
                    else if (inside(s)) {
                        outputList.push(intersection());
                    }
                    s = e;
                }
                cp1 = cp2;
            }
            return outputList;
        }




var map;
var geocoder = new google.maps.Geocoder();

var b1 = [0,0];
var b2 = [0,0];

LatLonToUTMXY(DegToRad(60.1),DegToRad(10.1),32,b1);
LatLonToUTMXY(DegToRad(59.5),DegToRad(11.5),32,b2);

//var bounds = {xl: b1[0], yt: b1[1],
	//xr: b2[0], yb: b2[1]};
var bounds = {xl: 0, yb: (b1[1]-b2[1])/1000,
	xr: (b2[0]-b1[0])/1000, yt: 0};

var osloborder = [
 { k: 59.91076081616976, B: 10.64249038696289 },
 { k: 59.910631722724226, B: 10.646309852600098 },
 { k: 59.91200869359696, B: 10.646696090698242 },
 { k: 59.911879605003826, B: 10.651116371154785 },
 { k: 59.91353620383488, B: 10.655064582824707 },
 { k: 59.91534330827699, B: 10.659613609313965 },
 { k: 59.917903204499275, B: 10.667295455932617 },
 { k: 59.9197100711994, B: 10.672616958618164 },
 { k: 59.91781716077409, B: 10.674247741699219 },
 { k: 59.91437522884636, B: 10.663347244262695 },
 { k: 59.91274018614317, B: 10.657167434692383 },
 { k: 59.906543503974774, B: 10.656137466430664 },
 { k: 59.90632832062227, B: 10.662918090820312 },
 { k: 59.89870993144821, B: 10.667810440063477 },
 { k: 59.894189722105466, B: 10.673990249633789 },
 { k: 59.89427582707762, B: 10.679140090942383 },
 { k: 59.89625617984176, B: 10.68943977355957 },
 { k: 59.89802117736653, B: 10.69021224975586 },
 { k: 59.90297127975913, B: 10.702486038208008 },
 { k: 59.906543503974774, B: 10.698108673095703 },
 { k: 59.90860919320748, B: 10.694246292114258 },
 { k: 59.91144930606805, B: 10.695362091064453 },
 { k: 59.915106669245674, B: 10.691585540771484 },
 { k: 59.91463338612184, B: 10.696907043457031 },
 { k: 59.91002928000784, B: 10.703859329223633 },
 { k: 59.9089964956315, B: 10.707721710205078 },
 { k: 59.90572579981651, B: 10.707979202270508 },
 { k: 59.90426248948507, B: 10.71390151977539 },
 { k: 59.9066726133169, B: 10.717248916625977 },
 { k: 59.90551061116487, B: 10.721969604492188 },
 { k: 59.90766243492854, B: 10.72540283203125 },
 { k: 59.90951289183559, B: 10.729780197143555 },
 { k: 59.90839402324194, B: 10.732269287109375 },
 { k: 59.901034371034456, B: 10.740337371826172 },
 { k: 59.902153487632035, B: 10.746517181396484 },
 { k: 59.90731815249734, B: 10.749092102050781 },
 { k: 59.90658654047792, B: 10.751752853393555 },
 { k: 59.90340168857946, B: 10.752010345458984 },
 { k: 59.905596686792876, B: 10.757761001586914 },
 { k: 59.904520725405696, B: 10.757761001586914 },
 { k: 59.901378718619505, B: 10.750207901000977 },
 { k: 59.898623837969055, B: 10.753641128540039 },
 { k: 59.8956965268976, B: 10.750894546508789 },
 { k: 59.89074534021181, B: 10.754327774047852 },
 { k: 59.88665467289384, B: 10.744028091430664 },
 { k: 59.88514745798696, B: 10.747718811035156 },
 { k: 59.886137921198, B: 10.759992599487305 },
 { k: 59.882864973849955, B: 10.761280059814453 },
 { k: 59.87997934503246, B: 10.763254165649414 },
 { k: 59.875628893769864, B: 10.754542350769043 },
 { k: 59.87020079992784, B: 10.750722885131836 },
 { k: 59.86774494254018, B: 10.753641128540039 },
 { k: 59.86675393118481, B: 10.750980377197266 },
 { k: 59.86472872919227, B: 10.739479064941406 },
 { k: 59.86253103007265, B: 10.744199752807617 },
 { k: 59.86054866709676, B: 10.752782821655273 },
 { k: 59.86313433448648, B: 10.76162338256836 },
 { k: 59.86248793648153, B: 10.765571594238281 },
 { k: 59.86658157836937, B: 10.764455795288086 },
 { k: 59.867486420685786, B: 10.767374038696289 },
 { k: 59.865418173502526, B: 10.771150588989258 },
 { k: 59.86942528560934, B: 10.777502059936523 },
 { k: 59.8724841537294, B: 10.777759552001953 },
 { k: 59.867831116045046, B: 10.781707763671875 },
 { k: 59.857704200821566, B: 10.782995223999023 },
 { k: 59.84955733824501, B: 10.779476165771484 },
 { k: 59.842831441005266, B: 10.773553848266602 },
 { k: 59.83782925170776, B: 10.768918991088867 },
 { k: 59.83278317873715, B: 10.77157974243164 },
 { k: 59.83019515238595, B: 10.76411247253418 },
 { k: 59.82406935545449, B: 10.772867202758789 },
 { k: 59.82631273576763, B: 10.779218673706055 },
 { k: 59.82312018753514, B: 10.795698165893555 },
 { k: 59.82532049003115, B: 10.812005996704102 },
 { k: 59.818158187807036, B: 10.817584991455078 },
 { k: 59.81699308945054, B: 10.845823287963867 },
 { k: 59.821178623471276, B: 10.862388610839844 },
 { k: 59.834206507509315, B: 10.865049362182617 },
 { k: 59.84412498833471, B: 10.872688293457031 },
 { k: 59.840416684833684, B: 10.851402282714844 },
 { k: 59.84800532874115, B: 10.845909118652344 },
 { k: 59.85671289027687, B: 10.84376335144043 },
 { k: 59.86136748351594, B: 10.841445922851562 },
 { k: 59.86481491051262, B: 10.85123062133789 },
 { k: 59.866969370948034, B: 10.84676742553711 },
 { k: 59.872139506599204, B: 10.852775573730469 },
 { k: 59.874638117358124, B: 10.848655700683594 },
 { k: 59.879720918289394, B: 10.85723876953125 },
 { k: 59.88135758706341, B: 10.862903594970703 },
 { k: 59.88979807258723, B: 10.858955383300781 },
 { k: 59.904951114144204, B: 10.85500717163086 },
 { k: 59.90787760963525, B: 10.85775375366211 },
 { k: 59.90873829451749, B: 10.866336822509766 },
 { k: 59.914160096249766, B: 10.862560272216797 },
 { k: 59.91897873224251, B: 10.866680145263672 },
 { k: 59.9213877879111, B: 10.872859954833984 },
 { k: 59.9200972441226, B: 10.880756378173828 },
 { k: 59.92654946120761, B: 10.881099700927734 },
 { k: 59.928957967300754, B: 10.888824462890625 },
 { k: 59.93110827141881, B: 10.887107849121094 },
 { k: 59.930592211142276, B: 10.89019775390625 },
 { k: 59.93351644655786, B: 10.897579193115234 },
 { k: 59.93325843615559, B: 10.909252166748047 },
 { k: 59.92732364294909, B: 10.913372039794922 },
 { k: 59.928527889750846, B: 10.92092514038086 },
 { k: 59.931624323667, B: 10.927276611328125 },
 { k: 59.93953611953632, B: 10.937576293945312 },
 { k: 59.943577286894005, B: 10.945301055908203 },
 { k: 59.949681095129826, B: 10.940666198730469 },
 { k: 59.95913548025017, B: 10.939464569091797 },
 { k: 59.96076823724782, B: 10.933971405029297 },
 { k: 59.963689812116996, B: 10.932769775390625 },
 { k: 59.97125033900944, B: 10.933971405029297 },
 { k: 59.97563121816456, B: 10.933799743652344 },
 { k: 59.97717727243941, B: 10.929508209228516 },
 { k: 59.97262479485998, B: 10.91543197631836 },
 { k: 59.97064899663707, B: 10.894660949707031 },
 { k: 59.967384376089846, B: 10.887279510498047 },
 { k: 59.97228118624518, B: 10.875091552734375 },
 { k: 59.967384376089846, B: 10.861186981201172 },
 { k: 59.95973703166295, B: 10.861701965332031 },
 { k: 59.95225983128989, B: 10.839557647705078 },
 { k: 59.947016190320134, B: 10.839042663574219 },
 { k: 59.94529678319638, B: 10.831832885742188 },
 { k: 59.95140027486193, B: 10.83200454711914 },
 { k: 59.956127559363374, B: 10.82204818725586 },
 { k: 59.949681095129826, B: 10.811576843261719 },
 { k: 59.94873550826831, B: 10.805225372314453 },
 { k: 59.95268960114451, B: 10.799217224121094 },
 { k: 59.970219459686085, B: 10.797843933105469 },
 { k: 59.97142214911034, B: 10.792694091796875 },
 { k: 59.9698758261143, B: 10.77484130859375 },
 { k: 59.966353376432146, B: 10.762825012207031 },
 { k: 59.96669704655032, B: 10.75063705444336 },
 { k: 59.968587168465604, B: 10.748405456542969 },
 { k: 59.96832943091918, B: 10.74188232421875 },
 { k: 59.96643929429596, B: 10.741024017333984 },
 { k: 59.96643929429596, B: 10.73690414428711 },
 { k: 59.97210938060085, B: 10.732784271240234 },
 { k: 59.9698758261143, B: 10.722827911376953 },
 { k: 59.96197126986652, B: 10.720252990722656 },
 { k: 59.95776046458139, B: 10.713043212890625 },
 { k: 59.9641194337505, B: 10.712013244628906 },
 { k: 59.961197896769185, B: 10.700511932373047 },
 { k: 59.96566602549886, B: 10.695362091064453 },
 { k: 59.96197126986652, B: 10.686092376708984 },
 { k: 59.962229056887246, B: 10.673904418945312 },
 { k: 59.968157604774, B: 10.674934387207031 },
 { k: 59.972195283534425, B: 10.66995620727539 },
 { k: 59.97228118624518, B: 10.65399169921875 },
 { k: 59.98129973092376, B: 10.65450668334961 },
 { k: 59.979410334504294, B: 10.643863677978516 },
 { k: 59.970563089692526, B: 10.642318725585938 },
 { k: 59.96497866030282, B: 10.63699722290039 },
 { k: 59.96248684190213, B: 10.629444122314453 },
 { k: 59.960381538914575, B: 10.628585815429688 },
 { k: 59.95427970115118, B: 10.63201904296875 },
 { k: 59.94839165181258, B: 10.63528060913086 },
 { k: 59.94482393060335, B: 10.635709762573242 },
 { k: 59.9390201903793, B: 10.631418228149414 },
 { k: 59.93566645519473, B: 10.63502311706543 },
 { k: 59.92943104616593, B: 10.626869201660156 },
 { k: 59.926592471778285, B: 10.625839233398438 },
 { k: 59.92216209009431, B: 10.626182556152344 },
 { k: 59.91798924800136, B: 10.630731582641602 },
 { k: 59.918118312836256, B: 10.633563995361328 },
 { k: 59.91648345450877, B: 10.633993148803711 },
 { k: 59.91514969464957, B: 10.632877349853516 },
 { k: 59.91398798916859, B: 10.634679794311523 },
 { k: 59.91467641213923, B: 10.635881423950195 },
 { k: 59.91381588119508, B: 10.6402587890625 },
];



var colormap = ["#fff7f3", "#fde0dd", "#fcc5c0", "#fa9fb5", "#f768a1", "#dd3497", "#ae017e", "#7a0177", "#49006a"]
colormap = [ "#8e0152",
"#c51b7d",
"#de77ae",
"#f1b6da",
"#fde0ef",
"#e6f5d0",
"#b8e186",
"#7fbc41",
"#4d9221",
"#276419",
];

//colormap = ["#0000FF","#1B00E4","#4100BE","#62009D","#7D0082","#980067","#B3004C","#D4002B","#E90016","#FF0000"];


/*

var skoler = ["AbildsÃ¸ skole","Mortensrud skole","BoltelÃ¸kka skole","MÃ¸llergata skole",'Ammerud skole'];
var andel = [10,20,30,40,50,60];
var skoledata = [];
for(var i = 0; i < skoler.length; i++) {
	skoledata.push({name:skoler[i],andel:andel[i]});
}

*/

skoledata = [
{name: "Abildsø skole", andel: 26.1, loc: { lat: 59.8813684, lng: 10.8253994 }},
{name: "Ammerud skole", andel: 70.8, loc: { lat: 59.9651139, lng: 10.8736696 }},
{name: "Apalløkka skole", andel: 63.4, loc: { lat: 59.9594765, lng: 10.8642419 }},
{name: "Bakås skole", andel: 46.2, loc: { lat: 59.9376243, lng: 10.9107219 }},
{name: "Bekkelaget skole", andel: 2.6, loc: { lat: 59.8823187, lng: 10.7849945 }},
{name: "Bestum skole", andel: 20.8, loc: { lat: 59.924092, lng: 10.6543293 }},
{name: "Bjølsen skole", andel: 50.1, loc: { lat: 59.9395477, lng: 10.7569341 }},
{name: "Bjørndal skole", andel: 72.6, loc: { lat: 59.8258566, lng: 10.836772 }},
{name: "Bjørnholt skole", andel: 64.8, loc: { lat: 59.8344206, lng: 10.8379555 }},
{name: "Bjørnsletta skole", andel: 19, loc: { lat: 59.9287134, lng: 10.6423349 }},
{name: "Bjøråsen skole", andel: 69.1, loc: { lat: 59.9707557, lng: 10.9000314 }},
{name: "Bogstad skole", andel: 6.9, loc: { lat: 59.9612164, lng: 10.6363405 }},
{name: "Bolteløkka skole", andel: 25.6, loc: { lat: 59.9274044, lng: 10.7348055 }},
{name: "Brannfjell skole", andel: 15.2, loc: { lat: 59.8878405, lng: 10.7822185 }},
{name: "Bryn skole", andel: 62.5, loc: { lat: 59.9144542, lng: 10.8233515 }},
{name: "Bygdøy skole", andel: 14.9, loc: { lat: 59.9050051, lng: 10.6763686 }},
{name: "Bøler skole", andel: 17.5, loc: { lat: 59.8837258, lng: 10.8490388 }},
{name: "Disen skole", andel: 5.9, loc: { lat: 59.9484223, lng: 10.7944977 }},
{name: "Ekeberg skole", andel: 16, loc: { lat: 59.8949755, lng: 10.7840506 }},
{name: "Ellingsrud skole", andel: 61.3, loc: { lat: 59.9351294, lng: 10.9175331 }},
{name: "Ellingsrudåsen skole", andel: 62.8, loc: { lat: 59.9352815, lng: 10.92099 }},
{name: "Engebråten skole", andel: 13.4, loc: { lat: 59.9597504, lng: 10.775631 }},
{name: "Frydenberg skole", andel: 62.6, loc: { lat: 59.9280417, lng: 10.7898088 }},
{name: "Furuset skole", andel: 84.5, loc: { lat: 59.9396217, lng: 10.8914102 }},
{name: "Fyrstikkalleen skole", andel: 53.7, loc: { lat: 59.915257, lng: 10.794332 }},
{name: "Gamlebyen skole", andel: 62.1, loc: { lat: 59.9068125, lng: 10.7704457 }},
{name: "Godlia skole", andel: 31.1, loc: { lat: 59.907019, lng: 10.8469506 }},
{name: "Gran skole", andel: 96.6, loc: { lat: 59.9434559, lng: 10.8973148 }},
{name: "Grefsen skole", andel: 16.6, loc: { lat: 59.9549349, lng: 10.773233 }},
{name: "Grorud skole", andel: 65.2, loc: { lat: 59.9583016, lng: 10.8828015 }},
{name: "Groruddalen skole", andel: 63.4, loc: { lat: 59.9544342, lng: 10.8886775 }},
{name: "Grünerløkka skole", andel: 40.2, loc: { lat: 59.926392, lng: 10.761662 }},
{name: "Hallagerbakken skole", andel: 50.4, loc: { lat: 59.8412678, lng: 10.7915871 }},
{name: "Hasle skole", andel: 31.2, loc: { lat: 59.9222604, lng: 10.7892529 }},
{name: "Haugen skole", andel: 83.7, loc: { lat: 59.9472873, lng: 10.9054436 }},
{name: "Haugenstua skole", andel: 69.6, loc: { lat: 59.954165, lng: 10.9207993 }},
{name: "Haugerud skole", andel: 83.5, loc: { lat: 59.922516, lng: 10.85941 }},
{name: "Hauketo skole", andel: 53.9, loc: { lat: 59.8382161, lng: 10.8137147 }},
{name: "Haukåsen skole", andel: 58.2, loc: { lat: 59.922388, lng: 10.863519 }},
{name: "Holmlia skole", andel: 73.7, loc: { lat: 59.833449, lng: 10.790575 }},
{name: "Hovseter skole", andel: 19.6, loc: { lat: 59.9497355, lng: 10.654615 }},
{name: "Huseby skole", andel: 17.1, loc: { lat: 59.9457717, lng: 10.6523279 }},
{name: "Høyenhall skole", andel: 34.3, loc: { lat: 59.9000855, lng: 10.8123795 }},
{name: "Ila skole", andel: 40.9, loc: { lat: 59.9273599, lng: 10.7459357 }},
{name: "Jeriko skole", andel: 61.3, loc: { lat: 59.9337517, lng: 10.8859744 }},
{name: "Jordal skole", andel: 64.5, loc: { lat: 59.9082262, lng: 10.78312 }},
{name: "Kampen skole", andel: 48.9, loc: { lat: 58.9721823, lng: 5.7165386 }},
{name: "Karlsrud skole", andel: 26.8, loc: { lat: 59.8777514, lng: 10.8094878 }},
{name: "Kastellet skole", andel: 12, loc: { lat: 59.8734781, lng: 10.7922318 }},
{name: "Kjelsås skole", andel: 10.4, loc: { lat: 59.9655597, lng: 10.7852851 }},
{name: "Klemetsrud skole", andel: 49.2, loc: { lat: 59.8352193, lng: 10.8442266 }},
{name: "Korsvoll skole", andel: 14.9, loc: { lat: 59.9641373, lng: 10.7512739 }},
{name: "Kringsjå skole", andel: 16.7, loc: { lat: 59.9626344, lng: 10.7303296 }},
{name: "Lakkegata skole", andel: 58.5, loc: { lat: 59.9206356, lng: 10.7683893 }},
{name: "Lambertseter skole", andel: 28.9, loc: { lat: 59.870916, lng: 10.8153564 }},
{name: "Lilleaker skole", andel: 14.3, loc: { lat: 59.9231515, lng: 10.6391752 }},
{name: "Lilleborg skole", andel: 43.1, loc: { lat: 59.9331856, lng: 10.7648789 }},
{name: "Lindeberg skole", andel: 80.1, loc: { lat: 59.9312732, lng: 10.8794565 }},
{name: "Linderud skole", andel: 81.4, loc: { lat: 59.9401139, lng: 10.8338104 }},
{name: "Ljan skole", andel: 12.7, loc: { lat: 59.846959, lng: 10.7863106 }},
{name: "Lofsrud skole", andel: 70.1, loc: { lat: 59.8459716, lng: 10.8277253 }},
{name: "Lusetjern skole", andel: 68.5, loc: { lat: 59.8324024, lng: 10.7890637 }},
{name: "Lutvann skole", andel: 71.6, loc: { lat: 59.9257328, lng: 10.8696113 }},
{name: "Lysejordet skole", andel: 15.1, loc: { lat: 59.9373395, lng: 10.6400577 }},
{name: "Lønnebakken skole", andel: 41.4, loc: { lat: 59.9335304, lng: 10.7726383 }},
{name: "Løren skole", andel: 36.8, loc: { lat: 59.9313764, lng: 10.8024458 }},
{name: "Majorstuen skole", andel: 41.4, loc: { lat: 59.929325, lng: 10.713652 }},
{name: "Manglerud skole", andel: 25.7, loc: { lat: 59.8942022, lng: 10.8212007 }},
{name: "Marienlyst skole", andel: 28.6, loc: { lat: 59.9352908, lng: 10.7226281 }},
{name: "Midtstuen skole", andel: 7, loc: { lat: 59.9606694, lng: 10.6877537 }},
{name: "Mortensrud skole", andel: 94.3, loc: { lat: 59.8473376, lng: 10.8259741 }},
{name: "Munkerud skole", andel: 3.6, loc: { lat: 59.8587964, lng: 10.8109818 }},
{name: "Møllergata skole", andel: 80.4, loc: { lat: 59.9181888, lng: 10.7504066 }},
{name: "Nedre Bekkelaget skole", andel: 27.8, loc: { lat: 59.881009, lng: 10.771207 }},
{name: "Nordberg skole", andel: 13.2, loc: { lat: 59.9628019, lng: 10.7313782 }},
{name: "Nordpolen skole", andel: 53, loc: { lat: 59.9399284, lng: 10.7721806 }},
{name: "Nordseter skole", andel: 14.4, loc: { lat: 59.8669799, lng: 10.7951282 }},
{name: "Nordstrand skole", andel: 16.5, loc: { lat: 59.8607762, lng: 10.7940175 }},
{name: "Nordtvet skole", andel: 61.9, loc: { lat: 59.9516754, lng: 10.8726181 }},
{name: "Nordvoll skole", andel: 81.3, loc: { lat: 59.9240365, lng: 10.8645761 }},
{name: "Nøklevann skole", andel: 42.6, loc: { lat: 59.8766175, lng: 10.8485851 }},
{name: "Oppsal skole", andel: 14.8, loc: { lat: 59.8978111, lng: 10.8444365 }},
{name: "Prinsdal skole", andel: 55.1, loc: { lat: 59.8368435, lng: 10.81353 }},
{name: "Ris ungdomsskole", andel: 9.6, loc: { lat: 59.9460149, lng: 10.7071491 }},
{name: "Rommen skole", andel: 95.3, loc: { lat: 59.9668008, lng: 10.9133791 }},
{name: "Rosenholm skole", andel: 72.1, loc: { lat: 59.8296465, lng: 10.7850006 }},
{name: "Ruseløkka skole", andel: 45.1, loc: { lat: 59.9133017, lng: 10.7256149 }},
{name: "Rustad skole", andel: 44.4, loc: { lat: 59.871443, lng: 10.8384838 }},
{name: "Rødtvet skole", andel: 67.6, loc: { lat: 59.9542267, lng: 10.8579409 }},
{name: "Sagene skole", andel: 41.8, loc: { lat: 59.9307939, lng: 10.7592902 }},
{name: "Sinsen skole", andel: 59.8, loc: { lat: 59.9352982, lng: 10.7836377 }},
{name: "Skjønnhaug skole", andel: 77.2, loc: { lat: 59.9286447, lng: 10.8773468 }},
{name: "Skullerud skole", andel: 45, loc: { lat: 59.8704031, lng: 10.8479663 }},
{name: "Skøyen skole", andel: 14.7, loc: { lat: 59.9290585, lng: 10.6906114 }},
{name: "Skøyenåsen skole", andel: 21.3, loc: { lat: 59.8954769, lng: 10.8359384 }},
{name: "Slemdal skole", andel: 8.3, loc: { lat: 59.9514757, lng: 10.6924234 }},
{name: "Smestad skole", andel: 13.1, loc: { lat: 59.9325431, lng: 10.6827946 }},
{name: "Sollerudstranda skole", andel: 33.8, loc: { lat: 59.9135732, lng: 10.6474067 }},
{name: "Stasjonsfjellet skole", andel: 27.5, loc: { lat: 59.9491796, lng: 10.9282058 }},
{name: "Stenbråten skole", andel: 61.6, loc: { lat: 59.8531987, lng: 10.8242692 }},
{name: "Stig skole", andel: 88.4, loc: { lat: 59.9509728, lng: 10.9201322 }},
{name: "Stovner skole", andel: 63.7, loc: { lat: 59.9561631, lng: 10.9269713 }},
{name: "Svarttjern skole", andel: 62.1, loc: { lat: 59.9680935, lng: 10.9002892 }},
{name: "Svendstuen skole", andel: 11.6, loc: { lat: 59.9588253, lng: 10.6890455 }},
{name: "Tiurleiken skole", andel: 84.9, loc: { lat: 59.9624072, lng: 10.8938027 }},
{name: "Tokerud skole", andel: 76, loc: { lat: 59.966133, lng: 10.9307307 }},
{name: "Tonsenhagen skole", andel: 33.4, loc: { lat: 59.9461903, lng: 10.8294979 }},
{name: "Toppåsen skole", andel: 56.1, loc: { lat: 59.8332904, lng: 10.7999548 }},
{name: "Trasop skole", andel: 13.7, loc: { lat: 59.9041404, lng: 10.8511774 }},
{name: "Trosterud skole", andel: 75.6, loc: { lat: 59.9230292, lng: 10.858272 }},
{name: "Tveita skole", andel: 64.7, loc: { lat: 59.9136162, lng: 10.8386229 }},
{name: "Tåsen skole", andel: 7.8, loc: { lat: 59.953789, lng: 10.7513099 }},
{name: "Tøyen skole", andel: 98.4, loc: { lat: 59.9150368, lng: 10.7733143 }},
{name: "Ullevål skole", andel: 10.2, loc: { lat: 59.9421054, lng: 10.7334267 }},
{name: "Ullevålsveien skole", andel: 48.1, loc: { lat: 59.9291286, lng: 10.7361245 }},
{name: "Uranienborg skole", andel: 37.4, loc: { lat: 59.9201839, lng: 10.7192922 }},
{name: "Vahl skole", andel: 92.6, loc: { lat: 59.9167932, lng: 10.7668099 }},
{name: "Veitvet skole", andel: 80.5, loc: { lat: 59.9418603, lng: 10.8498268 }},
{name: "Vestli skole", andel: 80.6, loc: { lat: 60.008326, lng: 10.9160457 }},
{name: "Vestre Aker skole", andel: 36.7, loc: { lat: 59.9411409, lng: 10.7344363 }},
{name: "Vinderen skole", andel: 7.7, loc: { lat: 59.9415391, lng: 10.7064485 }},
{name: "Voksen skole", andel: 24.9, loc: { lat: 59.9548434, lng: 10.6528786 }},
{name: "Vålerenga skole", andel: 40.5, loc: { lat: 59.907375, lng: 10.789362 }},
{name: "Øraker skole", andel: 18.9, loc: { lat: 59.9254743, lng: 10.6388408 }},
{name: "Østensjø skole", andel: 17.7, loc: { lat: 59.8998321, lng: 10.8309358 }},
{name: "Årvoll skole", andel: 45.3, loc: { lat: 59.944257, lng: 10.8141849 }},

];

var skolemarkers = [];
var locs = [];
var voronoi = new Voronoi();
var diagram;
var infowindow = new google.maps.InfoWindow();

var locs = [];
var borderpoly;
function initialize() {

var colorlegend = document.getElementById("colorlegend");
var colorlegendstring = "";
var clen = colormap.length;
for(var i = 0; i < clen; i++) {
	colorlegendstring += "<div style='display:inline; margin-left: 1em; margin-right: 0.5em; padding-left: 1em; background-color: "+ colormap[i] + "'></div> " + 100.0*i/clen + "% - " + 100.0*(i+1)/clen + "%<br />";
}

colorlegend.innerHTML = colorlegendstring;

var styles = [
{stylers:[{saturation:-100}]}
];
  var mapOptions = {
    zoom: 11,
    center: new google.maps.LatLng(59.9138688,10.7522454),
	styles:styles,
  };
  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

  var osloborderpaths = [];
  var osloborderclip = [];
  for(var i = 0; i < osloborder.length; i++) {
	  osloborderpaths.push(new google.maps.LatLng(osloborder[i].k,osloborder[i].B));
	  osloborderclip.push([osloborder[i].k,osloborder[i].B]);

  }
 //osloborderclip.reverse();
  borderpoly = new google.maps.Polygon({
		  paths: osloborderpaths,
		  });
  //borderpoly.setMap(map);


	  for(var i = 0; i < skoledata.length; i++) {
		  //console.log(skoledata[i]);
		//var pos = new google.maps.LatLng(skoledata[i].loc.lat, skoledata[i].log.lng);

		  //var marker = new google.maps.Marker({map:map,
			  //position:skoledata[i].loc});


				//google.maps.event.addListener(marker,'click',function(infowindow,marker) {
					//infowindow.open(map,marker);
				//}.bind(this,infowindow,marker));

		  		var utmoutput = [0,0];
				LatLonToUTMXY(DegToRad(skoledata[i].loc.lat), DegToRad(skoledata[i].loc.lng), 32, utmoutput);
				console.log(skoledata[i].name);
				var diagramdata = {x:(utmoutput[0]-b1[0])/1000, y:(utmoutput[1]-b2[1])/1000,data:skoledata[i]};
				console.log(diagramdata);
				locs.push(diagramdata);


			  }


				  console.log("All points found");
				  diagram = voronoi.compute(locs,bounds);
				  console.log("Vornoi calculated");

				  for(var j = 0;j < diagram.cells.length; j++) {
					  var cell1 = diagram.cells[j];
					  var pts = [];
					  var pts2 = [];
					  for(var k = 0; k < cell1.halfedges.length; k++) {
						var p = cell1.halfedges[k].getStartpoint();
						var latlon = [0,0];
						UTMXYToLatLon(1000*p.x+b1[0],1000*p.y+b2[1],32,false,latlon);
						//latlon[0] -= b1[0];
						//latlon[1] -= b2[1];
						
						console.log("LATLON");
						console.log(latlon);
						pts.push( [RadToDeg(latlon[0]), RadToDeg(latlon[1])]);
					  }

					  //pts.reverse();

					  //console.log(pts);
					  //console.log(osloborderclip);
					  var clippedPolygon = clip(osloborderclip,pts);
					  //console.log(clippedPolygon);

					  for(var k = 0; k < clippedPolygon.length; k++) {
						  pts2.push( new google.maps.LatLng(clippedPolygon[k][0],clippedPolygon[k][1]));

					  }

					  var andel = cell1.site.data.andel;
					  var colorn = Math.floor(andel/100.0*colormap.length);
					  var color = colormap[colorn];
					  /*
					  console.log("COLOR");
					  console.log(i);
					  console.log();
					  console.log(andel);
					  console.log(colorn);
					  console.log(color);
					  */

					cell1.site.data.name;
					cell1.site.data.andel;


					  var cell = new google.maps.Polygon({
							  paths: pts2,
							 strokeColor: "#000000",
							    strokeOpacity: 0.2,
							    strokeWeight: 0.5,
							    fillColor: color,
							    fillOpacity: 0.5,
							  });

					  cell.setMap(map);
					google.maps.event.addListener(cell,'click', function(data,event) {
			  	 infowindow.setContent(
					"<p><b>"+data.name+"</b></p>Andel elever med annet morsmål enn norsk og samisk: "+data.andel+"%<br/>");
				infowindow.setPosition(data.loc);
				infowindow.open(map);
					}.bind(this,cell1.site.data));

				}


		  }

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
<div id="wrapper" style="position:relative; width: 100%; height: 100%;">
    <div id="map-canvas"></div>
    <div style="position:absolute; top: 20px; left: 100px; width: 300px; z-index:100; padding: 0.5em 2.0em 2.0em 2em; background-color: white; border: 1px solid black;">
<p><b>Elever med et annet morsmål enn norsk og samisk i grunnskolen i Oslo - skoleåret 2012/2013</b></p>
<div id="colorlegend" style="padding-bottom: 1em; "></div>
Kilde: <a href="http://www.utdanningsetaten.oslo.kommune.no/getfile.php/utdanningsetaten%20(UDE)/Internett%20(UDE)/EFP/Dokumenter/Antall%20elever%20fra%20spr%C3%A5klige%20minoriteter%20i%20grunnskolen%2020122013.pdf">Utdanningsetaten, Oslo Kommune</a>
</div>
  </body>
</html>


